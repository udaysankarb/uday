from flask import Flask, request, jsonify
import json
import os
from datetime import datetime
import logging

app = Flask(__name__)

LOG_DIR = 'logs'
CONFIG_FILE = 'logging_config.json'

def load_config():
    with open(CONFIG_FILE, 'r') as file:
        return json.load(file)

config = load_config()

@app.route('/log', methods=['POST'])
def log():
    log_data = request.json
    source = log_data['metadata']['source']
    log_file = os.path.join(LOG_DIR, source)
    
    if not os.path.exists(LOG_DIR):
        os.makedirs(LOG_DIR)
    
    with open(log_file, 'a') as f:
        f.write(json.dumps(log_data) + '\n')
    
    return jsonify({"status": "success"}), 200

if __name__ == '__main__':
    app.run(port=5000)
